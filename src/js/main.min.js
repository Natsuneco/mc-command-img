const commandInput=document.getElementById("commandInput"),dropShadowCheck=document.getElementById("dropShadow"),roundCornersCheck=document.getElementById("roundCorners"),canvas=document.getElementById("workCanvas"),ctx=canvas.getContext("2d"),downloadButton=document.getElementById("downloadButton"),copyButton=document.getElementById("copyButton"),copyButtonText=document.getElementById("copyButtonText");let noDecoration;fetch("mc-command-img.json").then(a=>a.json()).then(a=>{noDecoration=a.noDecoration,drawCommand()}).catch(a=>{window.alert("\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F"),console.error(a)});const colors=["#54fcfc","#fcfc54","#54fc54","#fc54fc","#fca800"],shadowColors=["#153e3e","#3e3e15","#153e15","#3e153e","#3e2900"],fontSize=48,paddiing=40;canvas.height=fontSize+2*paddiing,ctx.font=`${fontSize}px DotGothic16`;const spaceWidth=ctx.measureText(" ").width;commandInput.addEventListener("input",drawCommand),commandInput.addEventListener("change",drawCommand),dropShadowCheck.addEventListener("change",drawCommand),roundCornersCheck.addEventListener("change",drawCommand),downloadButton.addEventListener("click",()=>{let a=document.createElement("a");a.href=canvas.toDataURL("image/png"),a.download="command-img.png",a.click()}),copyButton.addEventListener("click",()=>{canvas.toBlob(a=>{const b=new ClipboardItem({"image/png":a});navigator.clipboard.write([b]).then(()=>{showCopyMessage(!0)}).catch(()=>{showCopyMessage(!1)})})});function drawCommand(){const a=commandInput.value,b=dropShadowCheck.checked,c=roundCornersCheck.checked,d=a.split(" "),e=ctx.measureText(a).width;parsePos(d),ctx.clearRect(0,0,canvas.width,canvas.height),canvas.width=e+2*paddiing,ctx.font=`${fontSize}px DotGothic16`,ctx.textBaseline="bottom",ctx.fillStyle="#1a2638",c?fillRoundRect(0,0,canvas.width,canvas.height,20):ctx.fillRect(0,0,canvas.width,canvas.height);let f=paddiing,g=0;for(let a in d){const c=d[a];noDecoration.includes(c)||c.startsWith("/")||c.startsWith("run ")||""===c?(b&&(ctx.fillStyle="#292929",ctx.fillText(c,f+5,fontSize+paddiing+5)),ctx.fillStyle="#a8a8a8",ctx.fillText(c,f,fontSize+paddiing)):(b&&(ctx.fillStyle=shadowColors[g%5],ctx.fillText(c,f+5,fontSize+paddiing+5)),ctx.fillStyle=colors[g%5],ctx.fillText(c,f,fontSize+paddiing),g++),f+=ctx.measureText(c).width+spaceWidth}}function parsePos(a){for(let b in a){if(b=+b,2<a.length&&b<a.length-2){const c=a[b],d=a[b+1],e=a[b+2];(+c!==NaN&&+d!==NaN&&+e!==NaN||c.startsWith("~")&&d.startsWith("~")&&e.startsWith("~")||c.startsWith("^")&&d.startsWith("^")&&e.startsWith("^"))&&a.splice(b,3,a.slice(b,b+3).join(" "))}"run"===a[b]&&void 0!==a[b+1]&&a.splice(b,2,a.slice(b,b+2).join(" "))}}function createRoundRectPath(a,b,c,d,e){var f=Math.PI;ctx.beginPath(),ctx.moveTo(a+e,b),ctx.lineTo(a+c-e,b),ctx.arc(a+c-e,b+e,e,f*(3/2),0,!1),ctx.lineTo(a+c,b+d-e),ctx.arc(a+c-e,b+d-e,e,0,f*(1/2),!1),ctx.lineTo(a+e,b+d),ctx.arc(a+e,b+d-e,e,f*(1/2),Math.PI,!1),ctx.lineTo(a,b+e),ctx.arc(a+e,b+e,e,Math.PI,f*(3/2),!1),ctx.closePath()}function fillRoundRect(a,b,c,d,e){createRoundRectPath(a,b,c,d,e),ctx.fill()}function showCopyMessage(a){copyButtonText.textContent=a?copyButton.dataset.successfulText:copyButton.dataset.failedText,window.setTimeout(()=>{copyButtonText.textContent=copyButton.dataset.normalText},3e3)}